# Changelog

このプロジェクトの全変更をこのファイルに記録します。

## [1.0.0] - 2026-01-28
### 追加 (Added)
- 初回リリース
- Firebase Hosting へのデプロイ


## [1.0.1] - 2026-01-29
### 追加 (Added)
- Firebase CRUD追加
- Firebase Analyticsを有効化


## [1.0.2] - 2026-02-3
### 追加 (Added)
- Firebase Authentication追加


## [1.0.3] - 2026-02-4
### 修正 (Fixed)
- **スマホ版Safariでの日付入力欄の視認性改善**
  - 課題：`input type="date"` が未選択時に空白で表示され、入力箇所であることが分かりにくかった。
  - 対策：CSSの `:invalid` 擬似クラスを用いて、未選択時に「日付を選択」というプレースホルダーを表示するよう変更。
  - 効果：直感的な操作が可能になり、UI/UXの向上を実現。


## [1.0.4] - 2026-02-04
### 変更 (Changed)
- **月間統計とランキングの連動機能の実装**
  - 課題：カレンダーの表示月を切り替えても、ランキングやグラフが全期間の合計を表示してしまっていた。
  - 対策：表示中の月（`viewDate`）の状態を `App.tsx`（親コンポーネント）にリフトアップ（状態の引き上げ）し、各コンポーネントで共有する構造に刷新。
  - 効果：カレンダーの月変更に合わせて、ランキングおよび棒グラフ（BarChart）が動的にフィルタリングされ、その月のデータのみを表示するように改善。

### 修正 (Fixed)
- **React フックの呼び出し順序の適正化**
  - ログイン状態の判定（早期リターン）より前に `useState` を定義するよう修正し、レンダリングエラーを解消。
  

## [1.0.5] - 2026-02-06
### 変更 (Changed)
- **学習記録フォームの日付入力仕様を変更**
  - 課題：日付選択UIは操作コストが高く、実利用（毎日の記録）では不要だった。
  - 対策：`input type="date"` を廃止し、当日の日付を自動表示する仕様に変更。
  - 実装：
    - フォーム上部に `TODAY : {date}` を表示
    - 日付はアプリ側で一元管理し、ユーザー入力を不要に
  - 効果：入力ステップが1つ減り、記録スピードとUXが向上。

### 改善 (Improved)
- **フォームUIの視認性向上**
  - 「TODAY : 日付」を横並びレイアウトに調整し、他の入力欄との一体感を強化。


## [1.1.1] - 2026-02-08
### 追加 (Added)
- **学習時間入力方式をタイマー計測方式に変更**
  - 課題：
    - 手動で学習時間を入力する方式では、計測の手間や入力ミスが発生しやすく、実際の学習体験と乖離していた。
    - 学習開始・終了の「行動」と記録が直結していなかった。
  - 対策：
    - 学習時間の手入力を廃止し、タイマーによる自動計測方式に変更。
    - 学習科目を選択後、再生（▶）ボタンで計測を開始し、停止（■）ボタン押下時点の経過時間を学習時間として確定する仕様を実装。
    - 計測された学習時間（秒数）を state として管理し、記録追加時に科目と紐づけて保存。
  - 効果：
    - 学習開始から記録までの操作フローが直感的になり、ユーザーの操作負荷を軽減。
    - 実際の学習行動に即した記録が可能となり、学習ログの信頼性と継続性が向上。

### 改善 (Improved)
- **フォーム責務の再整理**
  - タイマー計測ロジックを専用コンポーネントとして切り出し、入力フォームと分離。
  - 学習時間を「入力値」ではなく「計測結果」として扱う設計に変更し、state の責務を明確化。


### 修正 (Fixed)
- **時間データの管理単位を「秒（Integer）」へ統一**
  - 課題：
    - 以前の設計では学習時間を「分（Float）」で管理していたため、タイマーの秒数との変換過程で誤差が発生していた。
    - その結果、表示時に `NaN` が出力されたり、端数を含む不正確な時間表示になる不具合があった。
  - 対策：
    - アプリ全体のデータフローを「秒（整数値）」ベースに再設計。
    - 保存・集計・フィルタリング処理はすべて秒単位で統一し、表示直前でのみフォーマット変換を行う方式に変更。
    - 各表示コンポーネントにて「時：分：秒」および「時：分」形式へ変換するロジックを実装。
  - 効果：
    - `NaN` エラーを完全に解消。
    - タイマー計測値・記録リスト・統計データ間の整合性を100%担保。

- **時間表示形式の拡張（HH : MM : SS 対応）**
  - 課題：
    - 従来の `MM : SS` 表示では、1時間を超える学習記録を正しく表現できず、UI崩れの懸念があった。
  - 対策：
    - タイマーおよび学習記録リストの表示形式を `HH : MM : SS` に拡張。
    - 各桁をゼロパディングし、常に固定幅で表示する仕様に変更。
  - 効果：
    - 長時間学習時でも視認性とレイアウトの安定性を確保。

### 変更 (Changed)
- **統計コンポーネントの表示ロジック調整**
  - Ranking / Monthly：
    - 可読性を優先し、秒単位を切り捨てた上で「○時間 ○分」形式で表示するよう変更。
  - BarChart（ApexCharts）：
    - Y軸が「180m」などの過度に大きな分表記にならないよう、内部で時間換算を行い、
      フォーマッターにて「○h ○m」形式で表示する仕様に修正。


## [1.1.2] - 2026-02-11
### 追加 (Added)
- **学習時間入力方式をタイマー計測方式に変更**
  - 課題：スマホで使用した際、画面がスリープ（自動消灯）するとJavaScriptの動作が制限され、
  タイマーが止まってしまう。
  - 解決策：
    - **Screen Wake Lock API の導入**: タイマー計測中に画面が自動的に暗くなるのを防ぐ機能を実装。
    - **時刻差分計算方式への移行**: 従来の「1秒ずつ加算する方式」から、`Date.now()` を用いた「開始時刻との差分を計算する方式」へ変更。
  - 効果：
    - スマホを置いて長時間学習しても画面が消えず、計測が中断されない。
    - 万が一手動で画面をオフにしたり、他アプリへ一時的に切り替えたりしても、復帰時に経過時間が正確に反映される。
    - 一時停止と再開を繰り返しても、`accumulatedTime`（累積時間）の保持により正確な合算が可能。


## [1.1.3] - 2026-02-14

### 追加 (Added)

#### カレンダーと学習リストの動的連動機能の実装
- MONTHLYカレンダーで任意の日付をクリックすると、下のRECORDセクションがその日付を含む週に自動で切り替わる機能を実装。
- カレンダー上での月移動（‹ / ›）に合わせて、学習リストの表示範囲も連動して更新されるように変更。

---

### 変更 (Changed)

#### 週次データ抽出ロジックの改善
- 学習リスト（`StudyList`）の抽出基準を、実行時の「today」から、カレンダーで選択された「基準日（currentDate）」に変更。
- これにより、今週だけでなく、先週や先月といった過去の学習記録を遡って閲覧・編集することが可能に。

#### UI/UX の向上（視認性の強化）
- カレンダーでクリックした特定の日付を、リスト内でハイライト表示する仕組みを導入。
- 記録数が多い場合でも、対象日の編集箇所を瞬時に判別できるよう改善。

---

### 修正 (Fixed)

#### 過去データのフィルタリング不整合の解消
- 親コンポーネント（`App.tsx`）から子コンポーネント（`StudyList`）へ `currentDate` を正しく伝搬。
- 過去の記録が存在するにもかかわらず「勉強していません」と表示される不具合を解消。



# [1.2.0] - 2026-02-19

## 追加 (Added)
- AI学習アドバイザー「AIロボット」機能の実装

**課題:**  
数値やグラフの確認だけでなく、学習内容に対する具体的なフィードバックやモチベーション維持の仕組みが求められていた。

**対策:**  
- 画面右下に固定（position: fixed）されたAIロボットボタンを設置。  
- Gemini-2.5-flash API と連携し、実際の学習記録に基づいたパーソナライズされたアドバイスを生成する機能を導入。

**効果:**  
- 保存した瞬間にAIが反応することで、学習直後の達成感を強化。  
- 自分の学習傾向（苦手科目や時間帯）を客観的に把握できる環境を実現。


## 変更 (Changed)
- 保存完了時の自動フィードバックフローの導入  
- `addRecord` 関数の成功時をトリガーとして、AIが自動的に吹き出しを開きコメントを開始する仕組みを実装。  
- 「保存ボタンを押す → Firestore保存 → AI分析開始 → アドバイス表示」という一連のUXフローを構築。

## 改善 (Improved)
- 高度な学習分析プロンプトの設計  
  - 苦手分析: 記録回数が少ない、または学習時間が極端に短い科目を特定し、学習バランスを提案。  
  - 時間帯分析: 深夜学習への配慮や朝型学習の推奨など、生活リズムに合わせた声掛けを実装。  
  - キャラ設定: 「〜だロボ」という親しみやすい語尾と、褒めることを中心としたポジティブなトーンを徹底。

- UIアニメーションの追加  
  - 吹き出し（ポップオーバー）にふわっと浮き上がるようなフェードインアニメーションを適用。 